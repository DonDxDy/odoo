<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="mail.Composer" owl="1">
        <div class="o-Composer"
            t-att-class="{
                'o-hasCurrentPartnerAvatar': hasCurrentPartnerAvatar,
                'o-hasFooter': hasFooter,
                'o-hasHeader': hasHeader,
                'o-isCompact': isCompact,
                'o-isFocused': composer and composer.$$$hasFocus(mself),
            }"
            t-on-keydown="_onKeydown"
        >
            <t t-if="composer">
                <t t-if="isDropZoneVisible.value">
                    <DropZone
                        class="o-Composer-dropZone"
                        t-on-o-dropzone-files-dropped="_onDropZoneFilesDropped"
                        t-ref="dropzone"
                    />
                </t>
                <FileUploader
                    attachments="composer.$$$attachments(mself)"
                    newAttachmentExtraData="newAttachmentExtraData"
                    t-ref="fileUploader"
                />
                <t t-if="hasHeader">
                    <div class="o-Composer-coreHeader">
                        <t t-if="hasThreadName and composer.$$$thread(mself)">
                            <span class="o-Composer-threadName">
                                on: <b><t t-esc="composer.$$$thread(mself).$$$displayName(mself)"/></b>
                            </span>
                        </t>
                        <t t-if="hasFollowers and !composer.$$$isLog(mself)">
                            <!-- Text for followers -->
                            <small class="o-Composer-followers">
                                <b class="text-muted">To: </b>
                                <em class="text-muted">Followers of </em>
                                <b>
                                    <t t-if="composer.$$$thread(mself) and composer.$$$thread(mself).$$$name(mself)">
                                        &#32;&quot;<t t-esc="composer.$$$thread(mself).$$$name(mself)"/>&quot;
                                    </t>
                                    <t t-else="">
                                        this document
                                    </t>
                                </b>
                            </small>
                            <ComposerSuggestedRecipientList
                                thread="composer.$$$thread(mself)"
                            />
                        </t>
                    </div>
                </t>
                <t t-if="composer.$$$thread(mself) and composer.$$$thread(mself).$$$model(mself) === 'mail.channel' and composer.$$$thread(mself).$$$isMassMailing(mself)">
                    <div class="o-Composer-subject">
                        <input class="o-Composer-subjectInput" type="text" placeholder="Subject" t-on-input="_onInputSubject" t-ref="subject"/>
                    </div>
                </t>
                <t t-if="phasCurrentPartnerAvatar">
                    <div class="o-Composer-sidebarMain">
                        <img class="o-Composer-currentPartnerAvatar rounded-circle" t-att-src="currentPartnerAvatar" alt=""/>
                    </div>
                </t>
                <div
                    class="o-Composer-coreMain"
                    t-att-class="{
                        'o-isComposerCompact': isCompact,
                        'o-isComposerExtended': composer.$$$thread(mself) and composer.$$$thread(mself).$$$isMassMailing(mself),
                    }"
                >
                    <ComposerTextInput
                        class="o-Composer-textInput"
                        t-att-class="{
                            'o-Composer-textInput-isMobile': env.messaging.$$$device(mself).$$$isMobile(mself),
                            'o-hasCurrentPartnerAvatar': hasCurrentPartnerAvatar,
                            'o-isComposerCompact': isCompact,
                        }"
                        composer="composer"
                        hasMentionSuggestionsBelowPosition="hasMentionSuggestionsBelowPosition"
                        isCompact="isCompact"
                        sendShortcuts="textInputSendShortcuts"
                        t-on-o-composer-suggestion-clicked="_onComposerSuggestionClicked"
                        t-on-o-composer-text-input-send-shortcut="_onComposerTextInputSendShortcut"
                        t-on-paste="_onPasteTextInput"
                        t-key="composer.localId"
                        t-ref="textInput"
                    />
                    <div class="o-Composer-buttons" t-att-class="{ 'o-isComposerCompact': isCompact, 'o-isMobile': env.messaging.$$$device(mself).$$$isMobile(mself) }">
                        <div class="o-Composer-toolButtons"
                            t-att-class="{
                                'o-hasComposerCurrentPartnerAvatar': hasCurrentPartnerAvatar,
                                'o-isComposerCompact': isCompact,
                            }">
                            <t t-if="isCompact">
                                <div class="o-Composer-toolButtonSeparator"/>
                            </t>
                            <div class="o-Composer-primaryToolButtons" t-att-class="{ 'o-isComposerCompact': isCompact }">
                                <Popover position="'top'" t-on-o-emoji-selection="_onEmojiSelection">
                                    <!-- TODO FIXME o-isOpen not possible to code due to https://github.com/odoo/owl/issues/693 -->
                                    <button class="o-Composer-button o-Composer-buttonEmojis o-Composer-toolButton btn btn-light"
                                        t-att-class="{
                                            'o-isMobile': env.messaging.$$$device(mself).$$$isMobile(mself),
                                            'o-isOpen': false and state.displayed,
                                        }"
                                        t-on-keydown="_onKeydownEmojiButton"
                                    >
                                        <i class="fa fa-smile-o"/>
                                    </button>
                                    <t t-set="opened">
                                        <EmojisPopover t-ref="emojisPopover"/>
                                    </t>
                                </Popover>
                                <button class="o-Composer-button o-Composer-buttonAttachment o-Composer-toolButton btn btn-light fa fa-paperclip" t-att-class="{ 'o-isMobile': env.messaging.$$$device(mself).$$$isMobile(mself) }" title="Add attachment" type="button" t-on-click="_onClickAddAttachment"/>
                            </div>
                            <t t-if="isExpandable">
                                <div class="o-Composer-secondaryToolButtons">
                                    <button class="o-Composer-button o-Composer-buttonFullComposer o-Composer-toolButton btn btn-light fa fa-expand" t-att-class="{ 'o-isMobile': env.messaging.$$$device(mself).$$$isMobile(mself) }" title="Full composer" type="button" t-on-click="_onClickFullComposer"/>
                                </div>
                            </t>
                        </div>
                        <t t-if="isCompact">
                            <t t-call="mail.Composer.actionButtons"/>
                        </t>
                    </div>
                </div>
                <t t-if="hasFooter">
                    <div class="o-Composer-coreFooter" t-att-class="{ 'o-isComposerCompact': isCompact }">
                        <t t-if="hasThreadTyping">
                            <ThreadTextualTypingStatus class="o-Composer-threadTextualTypingStatus" thread="composer.$$$thread(mself)"/>
                        </t>
                        <t t-if="composer.$$$attachments(mself).length > 0">
                            <AttachmentList
                                class="o-Composer-attachmentList"
                                t-att-class="{ 'o-isComposerCompact': isCompact }"
                                areAttachmentsEditable="true"
                                attachmentsDetailsMode="attachmentsDetailsMode"
                                attachments="composer.$$$attachments(mself)"
                                showAttachmentsExtensions="showAttachmentsExtensions"
                                showAttachmentsFilenames="showAttachmentsFilenames"
                            />
                        </t>
                        <t t-if="!isCompact">
                            <t t-call="mail.Composer.actionButtons"/>
                        </t>
                    </div>
                </t>
            </t>
        </div>
    </t>

    <t t-name="mail.Composer.actionButtons" owl="1">
        <div class="o-Composer-actionButtons" t-att-class="{ 'o-isComposerCompact': isCompact }">
            <t t-if="hasSendButton">
                <button class="o-Composer-actionButton o-Composer-button o-Composer-buttonSend btn btn-primary"
                    t-att-class="{
                        'fa': env.messaging.$$$device(mself).$$$isMobile(mself),
                        'fa-paper-plane-o': env.messaging.$$$device(mself).$$$isMobile(mself),
                        'o-hasCurrentPartnerAvatar': hasCurrentPartnerAvatar,
                        'o-isLast': env.messaging.$$$device(mself).$$$isMobile(mself) or !hasDiscardButton,
                        'o-isComposerCompact': isCompact,
                    }"
                    t-att-disabled="!composer.$$$canPostMessage(mself) ? 'disabled' : ''"
                    type="button"
                    t-on-click="_onClickSend"
                >
                    <t t-if="!env.messaging.$$$device(mself).$$$isMobile(mself)"><t t-if="composer.$$$isLog(mself)">Log</t><t t-else="">Send</t></t>
                </button>
            </t>
            <t t-if="!env.messaging.$$$device(mself).$$$isMobile(mself) and hasDiscardButton">
                <button class="o-Composer-actionButton o-Composer-button o-Composer-buttonDiscard o-isLast btn btn-secondary" t-att-class="{ 'o-hasCurrentPartnerAvatar': hasCurrentPartnerAvatar, 'o-isComposerCompact': isCompact }" type="button" t-on-click="_onClickDiscard">
                    Discard
                </button>
            </t>
        </div>
    </t>

</templates>

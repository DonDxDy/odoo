<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="crm.pipelineReview">
        <div class="container-fluid o_pipeline">
            <t t-if="widget.data" >
                <div class="row">
                    <div class="o_crm_opportunity_pipeline mt16 mb32">
                        <t t-foreach="widget.data.stage_moves" t-as="stage">
                            <t t-call="o_crm_opportunity_stage" />
                        </t>
                    </div>
                </div>
                <div class="o_pipeline_content">
                    <div class="o_crm_pipeline_box">
                        <div class="o_pipeline_side_box">
                            <t t-set="opportunity_value" t-value="widget.data.opportunity" />
                            <b><t t-esc="opportunity_value.open_opp" /></b> Open Opportunities <br />
                            <t t-if="opportunity_value.opp_to_close.length !== 0">
                                <a class="o_click_action" name="Pipeline to close"><b><t t-esc="opportunity_value.opp_to_close.length" /></b> opportunities to close by the end of <t t-esc="widget.options.date.end_date" />.</a><br />
                            </t>
                            <t t-if="opportunity_value.opp_overpassed.length !== 0">
                                <a class="o_click_action" name="Overdue Opportunity" ><b><t t-esc="opportunity_value.opp_overpassed.length"/></b> opportunities with expected closing date overpassed with amount <t t-esc="widget.currency.symbol" /><t t-esc="opportunity_value.opp_overpassed_amount || 0" />.</a>
                            </t>
                        </div>
                        <div class="o_pipeline_side_box">
                            <b><t t-esc="widget.data.average_days"/> Days</b>
                            <br/>average time to close a deal
                        </div>
                    </div>
                    <div class="o_deals">
                        <b class="o_won_deals">
                            <t t-esc="widget.data.opportunity.won_opp.length"/>
                        </b>
                        <br />Won Opportunities<br />
                        <b><t t-esc="widget.currency.symbol" /><t t-esc="widget.won_opp_amount || 0" /></b>
                    </div>
                        <div class="o_piechart_img">
                            <img src="crm/static/src/img/pie_chart.png" alt="There isn't any won/lost opportunity" class="image-responsive mt8"/>
                        </div>
                        <div class="o_piechart_graph" />
                    <div class="o_deals">
                        <b class="o_lost_deals">
                            <t t-esc="widget.data.opportunity.lost_opp.length"/>
                        </b>
                        <br />Lost Opportunities<br />
                        <b><t t-esc="widget.currency.symbol" /><t t-esc="widget.lost_opp_amount || 0"/></b>
                    </div>
                    <div class="o_funnel">
                        <b>Probable Turnover</b>
                        <div class="o_funnelchart_img">
                            <img src="crm/static/src/img/funnel_chart.png" alt="There isn't any expected revenue for any stage" class="image-responsive mt8"/>
                        </div>
                        <a name="crm.crm_opportunity_report_view_pivot">
                            <div class="o_funnelchart_graph" />
                        </a>
                    </div>
                </div>
            </t>
        </div>
    </t>

    <t t-name="o_crm_opportunity_stage">
        <div class="o_crm_stage">
            <t t-if="stage === _.first(widget.data.stage_moves)">
                <div class="name text-primary">New Opportunities</div>
                <div class="percentage">
                    <t t-esc="widget.data.new_opp" />
                </div>
            </t>
            <t t-else="">
                <div class="name text-primary"><t t-esc="stage.name" /></div>
                <div class="percentage o_click_action" name="Pipeline">
                    <t t-esc="stage.percentage" /> % Conversion
                </div>
                <t t-esc="stage.data" /> Opportunity
            </t>
        </div>
    </t>

    <t t-name="crm.searchView">
        <div class="btn-group o_dropdown o_crm_opportunity_reports_filter_date">
            <a type="button" class="dropdown-toggle" data-toggle="dropdown">
                <span class="fa fa-calendar"/> 
                <t t-if="options.date.filter === 'Custom'">
                    From: <t t-esc="options.date.start_date"/>
                    To: <t t-esc="options.date.end_date" />
                </t>
                <t t-else="">
                    <t t-esc="options.date.filter"/>
                </t>
                <span class="caret"/>
            </a>
            <ul class="dropdown-menu o_filters_menu" role="menu">
                <li title="This Week" data-filter="This Week" class="o_crm_opportunity_report_date_filter"><a>This Week</a></li>
                <li title="This Month" data-filter="This Month" class="o_crm_opportunity_report_date_filter"><a>This Month</a></li>
                <li title="This Quarter" data-filter="This Quarter" class="o_crm_opportunity_report_date_filter"><a>This Quarter</a></li>
                <li title="This Financial Year" data-filter="This Year" class="o_crm_opportunity_report_date_filter"><a>This Year</a></li>
                <li class="divider"></li>
                <li class="js_foldable_trigger o_closed_menu" data-filter='custom_filter_date'><a>Custom</a></li>
                <li class="o_foldable_menu o_closed_menu" data-filter='custom_filter_date' style='margin-left: 10px; margin-right: 10px;'>
                    <label class="custom-date" for="date_from">Start Date :</label>
                    <div class="form-group custom-date">
                        <div class='o_datepicker o_report_datetimepicker'>
                            <input type='text' class="o_datepicker_input" name="date_from"/>
                            <span class="o_datepicker_button"/>
                        </div>
                    </div>
                    <label class="custom-date" for="date_to">End Date :</label>
                    <div class="form-group custom-date">
                        <div class='o_datepicker o_report_datetimepicker'>
                            <input type='text' class="o_datepicker_input" name="date_to"/>
                            <span class="o_datepicker_button"/>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary o_crm_opportunity_report_date_filter" data-filter="Custom">Apply</button>
                </li>
            </ul>
        </div>

        <div class="btn-group o_dropdown o_crm_opportunity_reports_filter">
            <a type="button" class="dropdown-toggle" data-toggle="dropdown">
                <span class="fa fa-filter"/>  Filters <span class="caret"/>
            </a>
            <ul class="dropdown-menu o_filters_menu" role="menu">
                <li title="My Pipeline" data-filter="my_pipeline" class="o_crm_opportunity_report_filter_extra"><a>My Pipeline</a></li>
                <li title="My Channel" data-filter="my_channel" class="o_crm_opportunity_report_filter_extra"><a>My Channel</a></li>
                <li class="divider"></li>

                <li class="js_foldable_trigger o_closed_menu" data-filter="custom_filter"><a>Custom</a></li>
                <li class="o_foldable_menu o_closed_menu" data-filter="custom_filter" style='margin-left: 10px; margin-right: 10px;'>
                    <div>
                        <b>Users</b><br />
                        <select class="o_auto_complete" data-filter="salesmen" multiple="multiple" style="min-width: 130px;">
                            <t t-foreach="users" t-as="user">
                                <option t-att-value="user.id"><t t-esc="user.name" /></option>
                            </t>
                        </select>
                    </div><br />
                    <div>
                        <b>Channel</b><br />
                        <select class="o_auto_complete" data-filter="sales_channel" multiple="multiple" style="min-width: 130px;">
                            <t t-foreach="salesTeam" t-as="team">
                                <option t-att-value="team.id"><t t-esc="team.name" /></option>
                            </t>
                        </select>
                    </div><br />
                    <button type="button" class="btn btn-primary o_opportunity_button_custom">Apply</button>
                </li>
            </ul>
        </div>
    </t>
</templates>

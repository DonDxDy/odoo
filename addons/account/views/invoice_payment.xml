<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="online_invoice_assets" name="Online Invoice Results assets">
        <script src="/web/static/lib/nvd3/d3.v3.js"></script>
        <script src="/web/static/lib/nvd3/nv.d3.js"></script>
        <link type="image/x-icon" rel="shortcut icon" t-att-href="x_icon or '/web/static/src/img/favicon.ico'"/>
        <script type="text/javascript" src="/web/static/src/js/services/session.js"></script>
        <link href="/web/static/lib/nvd3/nv.d3.css" rel="stylesheet" type="text/css"></link>
        <link rel="stylesheet" type="text/less" href="/web/static/src/less/import_bootstrap.less"/>
        <link rel="stylesheet" type="text/less" href="/web/static/src/less/fonts.less" />
        <link rel="stylesheet" type="text/less" href="/web/static/src/less/utils.less"/>
        <script type="text/javascript" src="/account/static/src/js/invoice_payment.js"></script>
    </template>

    <!-- Forbidden error messages-->
    <template id="403">
        <t t-call="account.layout">
            <div id="wrap">
                <div class="container">
                    <h1 class="mt32">403: Forbidden</h1>
                    <p>The page you were looking for could not be authorized.</p>
                    <p>Maybe you were looking for this popular page ?</p>
                    <li><a href="#">Home</a></li>
                </div>
            </div>
        </t>
    </template>

    <!-- new layout for online payment -->
    <template id="layout" name="Online Payment Layout">&lt;!DOCTYPE html&gt;
        <html>
            <head>
                <meta charset="utf-8" />
                <meta name="viewport" content="initial-scale=1"/>
                <title><t t-esc="title or 'Odoo Online Payment'"/></title>
                <t t-call-assets="web.assets_common"/>
                <t t-call-assets="account.online_invoice_assets"/>
            </head>
            <body>
                <header>
                    <div id="wrapwrap"></div>
                    <div><title>Odoo</title></div>
                </header>
                <main>
                    <t t-raw="0"/>
                </main>
            </body>
            <footer>
                <div class="container mt16 mb8">
                    <div class="pull-right" t-ignore="true" t-if="not editable"> Powered by <a href="http://www.odoo.com">Odoo</a>
                        <div>Bill and get paid online for free</div>
                    </div>
                    <div class="pull-left text-muted" itemscope="itemscope" itemtype="http://schema.org/Organization">Copyright &amp;copy; <span t-field="payment_request.company_id">Company Name</span>
                    </div>
                </div>
            </footer>
        </html>
    </template>

    <template id="payment_method" name="Payment Methods">
        <div class="modal fade" id="modalpayment" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&amp;times;</button>
                    <h4 class="modal-title">Payment</h4>
                </div>
                <div class="modal-body" id="sign-dialog">
                    <p>
                        <span>I agree that by paying this proposal, I
                        accept it on the behalf of </span><b t-field="payment_request.partner_id"/><span>, for an amount of </span>
                        <b data-id="total_amount" t-field="payment_request.invoiced_amount"
                        t-field-options='{"widget": "monetary", "display_currency": payment_request.currency_id}'/>
                        <span>with payment terms: </span><b t-field="payment_request.invoice_id.payment_term_id"/>.
                    </p>
                </div>
                <div class="modal-footer">
                    <div class="row text-left">
                        <div t-if="acquirers" id="payment_method" class="js_payment">
                            <input type='hidden' name="access_token" t-att-value="payment_request.access_token" t-if="payment_request.access_token"/>
                            <div class="col-md-6 col-sm-6 col-xs-6 col-lg-6">
                                <h4><strong>Payment Method:</strong></h4>
                                <ul class="list-unstyled">
                                    <t t-set="payment_methods_available" t-value="False"/>
                                    <t t-set="partner_country" t-value="payment_request.partner_id.country_id"/>
                                    <li t-foreach="acquirers or []" t-as="acquirer">
                                        <t t-if="not acquirer.country_ids or partner_country in acquirer.country_ids">
                                            <label t-if="buttons.get(acquirer.id)">
                                                <input t-att-value="acquirer.id" type="radio" name="acquirer" t-att-checked="acquirers[0] == acquirer" />
                                                <img class="media-object" style="width: 60px; display: inline-block;"
                                                t-att-title="acquirer.name"
                                                t-att-src="'/payment_%s/static/src/img/%s_icon.png' % (acquirer.provider, acquirer.provider)"/>
                                                <span t-field="acquirer.name"/>
                                                <span t-if="acquirer.fees_active">(processing fees apply)</span>
                                            </label>
                                            <t t-set="payment_methods_available" t-value="True"/>
                                        </t>
                                    </li>
                                    <li t-if="not payment_methods_available">
                                      <div class="alert alert-warning">
                                        <span>No payment gateway is available for your country</span>
                                      </div>
                                    </li>
                                     <li t-if="any(token for token in tokens if not token.acquirer_id.country_ids or partner_country in token.acquirer_id.country_ids)">
                                        <label>
                                            <input type="radio" name="acquirer" />
                                            <span class='fa fa-2x fa-credit-card'/>
                                            Saved Cards
                                        </label>

                                        <div class="list-group">
                                            <t t-foreach='tokens' t-as='token'>
                                                <a t-if="not token.acquirer_id.country_ids or partner_country in token.acquirer_id.country_ids" class="list-group-item btn_payment_token" t-att-data-acquirer="token.acquirer_id.id" t-att-data-token='token.id'>
                                                    <span class="js_radio fa fa-circle-o"></span>&amp;nbsp;
                                                    <t t-esc="token.name" />
                                                    <t t-if="len(set(tokens.mapped('acquirer_id')))>1">
                                                        (<t t-esc='token.acquirer_id.name'/>)
                                                    </t>
                                                    <span t-if="token.acquirer_id.fees_active">(processing fees apply)</span>
                                                </a>
                                            </t>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                            <div class="col-md-6 col-sm-6 col-xs-6 col-lg-6 text-right">
                                <t t-foreach="acquirers or []" t-as="acquirer">
                                    <div t-att-data-id="acquirer.id" class="o_invoice_payment_acquirer_button hidden pull-right">
                                        <div t-raw="buttons.get(acquirer.id)"/>
                                        <div class="token_hide">
                                            <div t-if="acquirer.save_token == 'ask'">
                                                <input type="checkbox" name="odoo_save_token" id="odoo_save_token"/>
                                                <label for="odoo_save_token">Save my payment data</label>
                                            </div>
                                            <div class="pre_msg" t-field="acquirer.pre_msg"/>
                                        </div>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="invoice_payment_detail" name="Payment Detail">
        <div id="wrap">
            <div t-att-class="payment_request.state == 'paid' and 'panel panel-success' or payment_request.state == 'pending' and 'panel panel-warning' or 'panel panel-default'">
                <t t-if="payment_request.state != 'open'">
                    <div class="panel-heading">
                        <div class="row">
                            <h4>
                                <div class="col-md-6" t-raw="message"/>
                            </h4>
                        </div>
                    </div>
                </t>
                <div class="panel-body">
                    <div class="mb8" style="margin-bottom:10px;">
                          <strong>Invoice Date:</strong> <span t-field="payment_request.invoice_id.date_invoice" t-options='{"widget": "date"}'/>
                    </div>
                    <div>
                        <div>
                            <strong>Invoicing Address</strong>
                        </div>
                        <div>
                            <address t-field="payment_request.partner_id" t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}'/>
                        </div>
                    </div>
                    <hr/>
                    <div class="row">
                        <div class="col-md-6">
                          <strong>Product</strong>
                        </div>
                        <div class="hidden-sm hidden-xs col-md-2 text-right">
                          <strong>Unit Price</strong>
                        </div>
                        <div class="hidden-sm hidden-xs col-md-2 text-right">
                          <strong>Quantity</strong>
                        </div>
                        <div class="hidden-sm hidden-xs col-md-2 text-right">
                          <strong>Subtotal</strong>
                        </div>
                    </div>
                    <t t-foreach="payment_request.invoice_id.invoice_line_ids" t-as="invoice_line">
                        <div class="row orders_vertical_align">
                            <div class="visible-lg hidden-sm hidden-xs col-md-1 text-center">
                                <span t-field="invoice_line.product_id.image" t-options="{'widget': 'image', 'class': 'img-rounded', 'style':'width: 48px;height:48px'}" />
                            </div>
                            <div id='product_name' class="col-md-5 col-sm-6 col-xs-4">
                                <span t-esc="invoice_line.product_id.name"/>
                            </div>
                            <div class="col-sm-2 col-xs-3 text-right">
                                <span t-field="invoice_line.price_unit" t-options='{"widget": "monetary", "display_currency": payment_request.currency_id}'/>
                            </div>
                            <div class="col-xs-2 text-right">
                                <span t-esc="invoice_line.quantity"/>
                            </div>
                            <div class="col-sm-2 col-xs-3 text-right">
                                <span t-field="invoice_line.price_subtotal" t-options='{"widget": "monetary", "display_currency": payment_request.currency_id}'/>
                            </div>
                        </div>
                    </t>
                    <hr/>
                    <div class="row">
                        <div class="col-md-6">
                          <div>
                            <strong>Contact</strong>
                          </div>
                          <div t-field="payment_request.invoice_id.user_id.partner_id" t-options='{"widget": "contact", "fields": ["email", "phone"]}'/>
                          <br/>
                        </div>
                        <div class="col-md-6">
                          <div class="row">
                            <div class="col-md-9 col-xs-8 text-right">
                              Untaxed Amount:
                            </div>
                            <div class="col-md-3 col-xs-4 text-right">
                              <span t-field="payment_request.invoice_id.amount_untaxed" t-options='{"widget": "monetary", "display_currency": payment_request.currency_id}'/>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-9 col-xs-8 text-right">
                              Taxes:
                            </div>
                            <div class="col-md-3 col-xs-4 text-right">
                              <span t-field="payment_request.invoice_id.amount_tax" t-options='{"widget": "monetary", "display_currency": payment_request.currency_id}'/>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-9 col-xs-8 text-right">
                              <strong>Total:</strong>
                            </div>
                            <div class="col-md-3 col-xs-4 text-right">
                              <strong><span t-field="payment_request.invoice_id.amount_total" t-options='{"widget": "monetary", "display_currency": payment_request.currency_id}'/></strong>
                            </div>
                          </div>
                          <hr/>
                          <div class="row">
                            <div class="col-md-9 col-xs-8 text-right">
                              <strong>Amount Due:</strong>
                            </div>
                            <div class="col-md-3 col-xs-4 text-right">
                              <strong><span t-field="payment_request.invoice_id.residual" t-options='{"widget": "monetary", "display_currency": payment_request.currency_id}'/></strong>
                            </div>
                          </div>
                        </div>
                      </div>
                </div>
            </div>
        </div>
    </template>

    <template id="invoice_pay" name="Payment">
        <t t-call="account.layout">
            <div id="wrap">
                <div class="container o_invoice_payment mt16">
                    <div class="oe_structure"/>
                    <div class="container mt16">
                        <div id="introduction" class="page-header mt16">
                                <span style="float:left;margin-right:15px;width: 18em;" t-field="payment_request.company_id.logo" t-options="{'widget': 'image'}" t-att-alt="'Logo of %s' % payment_request.company_id.name" t-att-title="payment_request.company_id.name"/>
                            <div>
                                <h3 style="float:left;margin-right:18%;margin-top:11px">
                                    Your Invoice<br></br>
                                    <em t-esc="payment_request.reference"/>
                                    <small t-field="payment_request.state"/>
                                </h3>
                                <div class="text-left">
                                <h2>
                                    <span t-esc="payment_request.invoiced_amount" t-options="{'widget': 'monetary', 'display_currency': payment_request.currency_id}"/>
                                </h2>
                                <strong>Due by <span class="ml16" t-esc="payment_request.due_date" t-options='{"widget": "date"}'/></strong>
                                <span class="hidden-print" style="padding-top: 40px;border-left: 1px solid grey;margin-left: 3%;"/>
                                </div>
                                <div class="hidden-print" t-ignore="true" style="margin-top: -50px;padding-left: 76%;">
                                    <ul class="list-inline">
                                        <li>
                                            <a target="_blank" style="font-size:" t-att-href="'/invoice/payment/%s' % payment_request.access_token+'?pdf=True'" t-att-title="payment_request.reference">
                                                <i class="fa fa-download fa-2x" aria-hidden="true"/>
                                            </a>
                                        </li>
                                        <li>
                                            <a class="hidden-sm hidden-xs" t-att-title="payment_request.reference" onclick="javascript:window.print();">
                                                <i class="fa fa-print fa-2x" aria-hidden="true"/>
                                            </a>
                                        </li>
                                        <li>
                                            <t t-if="payment_request.state != 'paid'">
                                                <a class="btn btn-primary btn-lg"  data-toggle="modal" data-target="#modalpayment">
                                                    <i class="fa fa-arrow fa-5x" aria-hidden="true"/>Pay Now
                                                </a>
                                            </t>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="row mt32">
                            <div class="col-md-12">
                                <t t-call="account.invoice_payment_detail"/>
                            </div>
                        </div>
                        <t t-call="account.payment_method"/>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="payment_token_form">
        <form method='POST' action="/invoice/payment/transaction_token">
            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
            <input type="hidden" name="tx_id" t-att-value="tx.id"/>
        </form>
    </template>

    <template id="payment_token_form_confirm">
        <div id="wrap">
            <div class="container">
                <div class="row">
                    <h2 class="mb32 ml16">Confirm <em t-field="tx.payment_request_id.reference" /> Payment</h2>
                </div>
                <div class="row">
                    <div class="col-lg-8 col-md-9 col-sm-12">
                        <div class='row'>
                            <div class='col-sm-4 well'>
                                <div class="h4 text-center">Summary</div>
                                <div>
                                    <span class="col-xs-6 text-right text-muted">Subtotal:</span>
                                    <span class="col-xs-6 text-right-not-xs text-left-xs text-muted">
                                        <span t-field="payment_request.invoice_id.amount_untaxed" t-options='{"widget": "monetary","display_currency": payment_request.currency_id}' style="white-space: nowrap;" />
                                    </span>
                                    <span class="col-xs-6 text-right text-muted">Taxes:</span>
                                    <span class="col-xs-6 text-right-not-xs text-left-xs text-muted">
                                        <span t-field="payment_request.invoice_id.amount_tax" t-options='{"widget": "monetary","display_currency": payment_request.currency_id}'/>
                                    </span>
                                    <span class="col-xs-6 text-right h4">Total:</span>
                                    <span class="col-xs-6 text-right-not-xs text-left-xs h4" style="white-space: nowrap;">
                                        <span t-field="payment_request.invoiced_amount" t-options='{"widget": "monetary","display_currency": payment_request.currency_id}' style="white-space: nowrap;" />
                                    </span>
                                </div>
                            </div>
                            <div class="o_pay_token col-sm-8">
                            <div class="panel panel-info">
                                <div class="panel-body">
                                    <div class='js_token_load' style='display:none;'>Transaction processing ...</div>
                                        <div class='js_token_load'>
                                            <p class="text-center">
                                                <i class="fa fa-3x fa-credit-card text-muted" aria-hidden="true"></i><br/>
                                                    Are you sure you want to pay with this card: <br/>
                                                <b><t t-esc='tx.payment_token_id.short_name'/></b>
                                            </p>

                                            <div class='mt16 text-center'>
                                                <form action="/invoice/payment/transaction_token/confirm" method='POST'>
                                                  <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                                  <input type='hidden' name='tx_id' t-att-value='tx.id'/>
                                                  <a class="btn btn-success btn-md js_btn_valid_tx">Yes, pay with this card</a>
                                                  <a t-att-href="'/invoice/payment/%s' % payment_request.invoice_id.id" class="btn btn-danger btn-md">No, choose another method</a>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-lg-offset-1 col-md-3 hidden-xs hidden-sm text-muted">
                        <div class="panel panel-info break-word">
                            <div class="panel-heading">Bill To:</div>
                            <div class="panel-body">
                            <div class="o_div_text_overflow" t-field="payment_request.partner_id" t-options='{"widget": "contact", "fields": ["address", "name", "phone", "email"]}'/>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
        <div class="oe_structure" />
    </template>

</odoo>

<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="weekly_digest_forum_template" model="mail.template">
        <field name="name">Weekly Digest Forum Template</field>
        <field name="model_id" ref="digest.model_digest_digest"/>
        <field name="auto_delete" eval="True" />
        <field name="email_from">${user.email}</field>
        <field name="lang">${user.lang}</field>
        <field name="body_html"><![CDATA[   

<table border="0" cellpadding="0" cellspacing="0" style="padding-top: 16px; background-color: #F1F1F1; font-family:Verdana, Arial,sans-serif; color: #454748; width: 100%; border-collapse:separate;"><tbody><tr><td align="center">
<table border="0" cellpadding="0" cellspacing="0" width="590" style="padding: 16px; background-color: white; color: #454748; border-collapse:separate;">
<tbody>
    <tr>
        <td align="center" style="min-width: 590px;">

            <h1>What's new on the forum :</h1>
            <h4><br/></h4>
            <h4>Best contributors :&nbsp;</h4>
            <p><br/></p>
                <table class="table table-bordered">
                    <tbody>
                        % for contributor in user.env.ref('digest_forum.server_action_find_best_contributeur').run()
                            <tr>
                                <td><p>${contributor['user'].name}</p></td>
                                <td><p>Score : ${contributor['score']}</p></td>
                                <td><p>Number of posts : ${contributor['nb_posts']}</p></td>
                            </tr>
                        % endfor
                    </tbody>
                </table>
            </t>
            <p><br/></p>
            <h4><br/></h4>
            <h4>Last posts :</h4>
            <p><br/></p>
            <table class="table table-bordered">
                <tbody>
                    <tr>
                        <th><p>Title</p></th>
                        <th><p>Vote score</p></th>
                        <th><p>Creation date</p></th>
                        <th><p>Author</p></th>
                    </tr>
                    % for post in user.env['forum.post'].search([('parent_id', '=', False), ('create_date', '>', datetime.datetime.now() - datetime.timedelta(days=7)),('create_uid.groups_id', 'in', user.env.ref('base.group_user').id)])
                        <tr>
                            <td><p>${post.name}</p></td>
                            <td><p>${post.vote_count}</p></td>
                            <td><p>${post.create_date.date()}</p></td>
                            <td><p>${post.create_uid.name}</p></td>
                        </tr>
                    % endfor
                </tbody>
            </table>
            <p><br/></p>
        </td>
    </tr>
</tbody>
</table>
</td></tr>
</tbody></table>
        ]]></field>
    </record>
</odoo>

<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="assets_backend" inherit_id="web.assets_backend" name="Payment Method Assets Backend">
        <xpath expr="." position="inside">
            <link rel="stylesheet" href="/payment/static/src/less/payment_acquirer.less"/>
        </xpath>
    </template>

    <template id="assets_frontend" inherit_id="web.assets_frontend" name="Payment Method frontend assets">
        <xpath expr="." position="inside">
            <script type="text/javascript" src="/payment/static/src/js/payment_method.js"></script>
        </xpath>
    </template>

    <!-- save payment data -->
    <template id="save_payment_data" name="Save My Payment Data">
        <div id="payment_data"> <!-- add class as per user ui view using xpath-->
            <t t-foreach="acquirers or []" t-as="acquirer" id="acquirers_list">
                <div t-att-data-id="acquirer.id" class="o_acquirer_button hidden pull-right">
                    <div t-raw="acquirer.button"/>
                    <div class="token_hide">
                        <div t-if="acquirer.save_token == 'ask'">
                            <input type="checkbox" name="odoo_save_token" id="odoo_save_token"/>
                            <label for="odoo_save_token">Save my payment data</label>
                        </div>
                        <div class="pre_msg" t-field="acquirer.pre_msg" />
                    </div>
                </div>
            </t>
        </div>
    </template>

    <!-- show all payment method -->
    <template id="payment_method" name="Payment Method">
        <div id="payment_list"> <!-- add class as per user ui view using xpath-->
            <!-- loaded all acquirer -->
            <h4><strong>Payment Method:</strong></h4>
            <ul class="list-unstyled">
                <t t-set="payment_methods_available" t-value="False"/>
                <t t-foreach="acquirers or []" t-as="acquirer">
                    <li t-if="not acquirer.country_ids or partner_country in acquirer.country_ids">
                        <label t-if="acquirer.button">
                            <input t-att-value="acquirer.id" type="radio" name="acquirer" t-att-checked="acquirers[0] == acquirer" />
                            <span t-field="acquirer.image_small" t-att-title="acquirer.name" t-options='{"widget": "image", "style":"max-width: 60px; display: inline-block"}'/>
                            <span t-field="acquirer.name" />
                            <span t-if="acquirer.fees_active">(processing fees apply)</span>
                        </label>
                        <t t-set="payment_methods_available" t-value="True"/>
                    </li>
                </t>
                <li t-if="not payment_methods_available">
                    <div class="alert alert-warning">
                        <span>No payment gateway is available for your country</span>
                    </div>
                </li>
                <li t-if="any(token for token in tokens if not token.acquirer_id.country_ids or partner_country in token.acquirer_id.country_ids)">
                    <label>
                        <input type="radio" name="acquirer" />
                        <span class='fa fa-2x fa-credit-card'/>
                        Saved Cards
                    </label>

                    <div class="list-group">
                        <t t-foreach='tokens' t-as='token'>
                            <a t-if="not token.acquirer_id.country_ids or partner_country in token.acquirer_id.country_ids" class="list-group-item btn_payment_token" t-att-data-acquirer="token.acquirer_id.id" t-att-data-token='token.id'>
                                <span class="js_radio fa fa-circle-o"></span>&amp;nbsp;
                                <t t-esc="token.name" />
                                <t t-if="len(set(tokens.mapped('acquirer_id')))>1">
                                    (<t t-esc='token.acquirer_id.name'/>)
                                </t>
                                <span t-if="token.acquirer_id.fees_active">(processing fees apply)</span>
                            </a>
                        </t>
                    </div>
                </li>
            </ul>
        </div>
    </template>

    <!-- payment modal -->
    <template id="payment" name="Payment">
        <div class="modal fade" id="modalpayment" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-content" id="modal-dialog">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&amp;times;</button>
                    <h4 class="modal-title">Payment Method</h4>
                </div>
                <div class="modal-body" id="sign-dialog">
                </div>
                <div class="modal-footer" id="modal_footer">
                    <div class="row text-left">
                        <div t-if="acquirers" id="payment_method" class="js_payment">
                            <div class="col-md-6">
                                <t t-call="payment.payment_method"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- use saved payment method for payment -->
    <template id="payment_token_form">
        <form method='POST' t-att-action="action">
            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
            <input type="hidden" name="tx_id" t-att-value="tx.id"/>
        </form>
    </template>

    <template id="payment_token_form_confirm">
        <div id="payment_token_wrap">
            <div class="container" id="payment_token_form"> <!-- update class as per requirement  -->
                <div class="row" id="payment_token_title">
                    <!-- pass tx_reference in controllers of module wise-->
                    <h2 class="mb32 ml16">Confirm <em t-field="tx_reference" /> Payment</h2>
                </div>
                <div class="row">
                    <div class="col-lg-8 col-md-9 col-sm-12">
                        <div class='row'>
                            <div class='col-sm-4 well'>
                                <div class="h4 text-center" id="payment_summary">Summary</div>
                                <!-- expand the view of module wise -->
                            </div>
                            <div class="o_pay_token col-sm-8">
                                <div class="panel panel-info">
                                    <div class="panel-body">
                                        <div class='js_token_load' style='display:none;'>Transaction processing ...</div>
                                        <div class='js_token_load'>
                                            <p class="text-center">
                                                <i class="fa fa-3x fa-credit-card text-muted" aria-hidden="true"></i><br/>
                                                Are you sure you want to pay with this card: <br/>
                                                <b><t t-esc='tx.payment_token_id.short_name'/></b>
                                            </p>
                                            <div class='mt16 text-center'>
                                                <form t-att-action="action_token_confirm" method='POST'>
                                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                                    <input type='hidden' name='tx' t-att-value='tx.id'/>
                                                    <a class="btn btn-success btn-md js_btn_valid_tx">Yes, pay with this card</a>
                                                    <a t-att-href='action_back' class="btn btn-danger btn-md">No, choose another method</a>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-lg-offset-1 col-md-3 hidden-xs hidden-sm text-muted" id="payment_bill_detail">
                        <!-- expand ship or bill detail using xpath -->
                    </div>
                </div>
            </div>
        </div>
    </template>

</odoo>

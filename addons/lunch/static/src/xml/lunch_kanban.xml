<?xml version="1.0" encoding="UTF-8"?>
<templates>
    <div t-name="LunchKanbanWidget" class="o_lunch_kanban_banner container-fluid">
        <div class="o_lunch_widget row py-3 py-md-0">
            <div class="o_lunch_widget_info col-12 col-md-4 card border-0">
                <div class="card-body row no-gutters align-items-center">
                    <div class="col-3 col-md-6 col-lg-3">
                        <img class="rounded-circle" t-attf-src="{{ widget.userimage }}"/>
                    </div>
                    <div class="col-9 col-md-6 col-lg-9">
                        <div class="pl-3">
                            <div class="o_lunch_user_field py-1"/>
                            <div class="o_lunch_location_field py-1"/>
                            <div class="d-flex flex-row py-1">
                                <span class="flex-grow-1">Your Account</span>
                                <span class="o_field_monetary o_field_number o_field_widget">
                                    <t t-esc="widget._formatMonetary(widget.wallet)"/>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="o_lunch_widget_info col-12 col-md-4 card border-0">
                <t t-if="!_.isEmpty(widget.lines)">
                    <t t-if="widget.raw_state == 'ordered'">
                        <t t-set="state_class" t-value="'badge-warning o_lunch_ordered'"/>
                    </t>
                    <t t-else="widget.raw_state == 'confirmed'">
                        <t t-set="state_class" t-value="'badge-success o_lunch_confirmed'"/>
                    </t>
                    <div class="card-body">
                        <h4 class="card-title">
                            Your order
                            <button t-if="widget.raw_state != 'confirmed'" class="btn btn-sm btn-icon btn-link fa fa-trash o_lunch_widget_unlink"/>
                            <span t-if="widget.raw_state != 'new'" t-esc="widget.state" t-attf-class="badge badge-pill {{ state_class }}"/>
                        </h4>
                        <ul class="list-unstyled o_lunch_widget_lines">
                            <li t-foreach="widget.lines" t-as="line">
                                <div class="d-flex align-items-center">
                                    <div class="flex-grow-0 flex-shrink-0 o_lunch_product_quantity">
                                        <button class="btn btn-sm btn-icon btn-link fa fa-minus-circle o_remove_product" t-if="widget.raw_state != 'confirmed'" t-attf-data-id="{{ line.id }}"/>
                                        <span t-esc="line.quantity"/>
                                        <button class="btn btn-sm btn-icon btn-link fa fa-plus-circle o_add_product" t-if="widget.raw_state != 'confirmed'" t-attf-data-id="{{ line.id }}"/>
                                    </div>
                                    <div class="flex-grow-1 pl-2">
                                        <button t-esc="line.product[1]" class="btn btn-link o_lunch_open_wizard" t-attf-data-product-id="{{ line.product[0] }}" t-attf-data-id="{{ line.id }}"/>
                                    </div>
                                    <div class="flex-grow-0">
                                        <span class="o_field_monetary o_field_number o_field_widget">
                                            <t t-esc="widget._formatMonetary(line.product[2])"/>
                                        </span>
                                    </div>
                                </div>
                                <div t-foreach="line.toppings" t-as="topping" class="d-flex flex-row">
                                    <div class="flex-grow-1 pl-5">
                                        <span>+ <t t-esc="topping[0]"/></span>
                                    </div>
                                    <div class="flex-grow-0">
                                        <span class="o_field_monetary o_field_number o_field_widget">
                                            <t t-esc="widget._formatMonetary(topping[1])"/>
                                        </span>
                                    </div>
                                </div>
                                <span t-if="line.note" t-esc="line.note" class="text-muted pl-5"/>
                            </li>
                        </ul>
                    </div>
                </t>
            </div>
            <div class="o_lunch_widget_info col-12 col-md-4 card border-0">
                <t t-if="!_.isEmpty(widget.lines) &amp;&amp; widget.raw_state == 'new'">
                    <div class="card-body d-flex flex-column justify-content-between">
                        <h4 class="card-title d-flex py-1">
                            <span class="flex-grow-1">Total</span>
                            <span class="o_field_monetary o_field_number o_field_widget">
                                <t t-esc="widget._formatMonetary(widget.total)"/>
                            </span>
                        </h4>
                        <button t-if="widget.raw_state == 'new'" class="btn btn-primary w-100 o_lunch_widget_order_button">Order now</button>
                    </div>
                </t>
            </div>
        </div>
        <t t-foreach="widget.alerts" t-as="alert">
            <div class="alert alert-warning" role="alert">
                <t t-raw="alert.message"/> <!-- alert.message is coming from a fields.Html so it should be safe -->
            </div>
        </t>
    </div>

    <div t-name="lunch.LunchPaymentDialog">
        <span t-esc="widget.message"/>
    </div>

    <t t-name="LunchKanbanWidgetMobile">
        <details class="fixed-bottom" t-attf-open="#{widget.keepOpen}">
            <summary class="o_lunch_toggle_cart btn btn-primary w-100">
                <i class="fa fa-fw fa-shopping-cart"/>
                Your cart
                (<span class="o_field_monetary o_field_number o_field_widget">
                    <t t-esc="widget._formatMonetary(widget.total)"/>
                </span>)
            </summary>
            <t t-call="LunchKanbanWidget"/>
        </details>
    </t>
</templates>

<?xml version="1.0" encoding="UTF-8"?>

<templates id="template" xml:space="preserve">
    <t t-name="hr_holidays.CalendarView" owl="1">
        <div class="o_timeoff_calendar">
            <t t-call="hr_holidays.dashboard_calendar_header"/>
            <t t-call="web.CalendarView"/>
        </div>
    </t>

    <t t-name="hr_holidays.dashboard_calendar_header" owl="1">
        <div class="o_timeoff_container d-flex">
            <div t-foreach="timeoffs" t-as="timeoff" t-attf-class="o_timeoff_card flex-grow-1 d-flex flex-column {{ timeoff_last ? 'o_timeoff_card_last' : '' }}">
                <t t-set="need_allocation" t-value="timeoff[2] !== 'no'"/>
                <t t-set="cl" t-value="'text-muted'"/>

                <t t-if="need_allocation and timeoff[1]['virtual_remaining_leaves'] gt 0">
                    <t t-set="cl" t-value="'o_timeoff_green'"/>
                </t>

                <div class="mt-2">
                    <t t-if="need_allocation">
                        <span t-esc="timeoff[1]['virtual_remaining_leaves']" class="o_timeoff_big o_timeoff_purple"/> / <span t-esc="timeoff[1]['max_leaves']"/> <t t-if="timeoff[1]['request_unit'] == 'hour'">Hours</t><t t-else="">Days</t>
                    </t>
                    <t t-else="">
                        <span t-esc="timeoff[1]['virtual_leaves_taken']" class="o_timeoff_big o_timeoff_purple"/> <t t-if="timeoff[1]['request_unit'] == 'hour'">Hours</t><t t-else="">Days</t>
                    </t>
                </div>

                <b><span t-esc="timeoff[0]" class="o_timeoff_name"/></b>

                <span class="mb-4" t-if="need_allocation">
                    <span t-attf-class="mr-1 font-weight-bold {{ cl }}" t-esc="timeoff[1]['virtual_leaves_taken']"/><span>taken</span>
                    <t t-if="timeoff[3]"> (Expire on <span t-esc="moment(timeoff[3]).format('L')"/>)</t>
                </span>
            </div>
        </div>
    </t>

    <t t-name="hr_holidays.dashboard.calendar.button">
        <button class="btn btn-primary btn-time-off" type="button">
            <t t-esc="time_off"/>
        </button>
        <button class="btn btn-secondary btn-allocation" type="button">
            <t t-esc="request"/>
        </button>
    </t>

    <t t-name="hr_holidays.CalendarPopover" t-inherit="web.CalendarPopover" t-inherit-mode="primary" owl="1">
        <xpath expr="//span[hasclass('o_cw_popover_close')]" position="replace">
            <div class="ml-auto">
                <i t-if="props.calendarIcon" t-attf-class="fa {{ props.calendarIcon }}"></i>
                <span class="o_cw_popover_close ml-1"
                    t-on-click="trigger('o-popover-close')"
                >
                    <i class="fa fa-close small"/>
                </span>
            </div>
        </xpath>
        <xpath expr="//*[@t-call='web.CalendarPopover.body']" position="attributes">
            <attribute name="t-call">hr_holidays.CalendarPopover.body</attribute>
        </xpath>
    </t>

    <t t-name="hr_holidays.CalendarPopover.body" t-inherit="web.CalendarPopover.body" t-inherit-mode="primary" owl="1">
        <xpath expr="//i[hasclass('fa-calendar-o')]" position="replace"></xpath>
        <xpath expr="//i[hasclass('fa-clock-o')]" position="replace"></xpath>
        <xpath expr="//CalendarPopoverFieldsAdapter" position="replace">
            <ul class="list-group list-group-flush o_cw_popover_fields_secondary" t-if="displayName">
                <li class="list-group-item">
                    <span class="o_field_char o_field_widget" t-esc="displayName" />
                </li>
            </ul>
        </xpath>
    </t>
</templates>

<templates>
    <t t-name="base_import.ImportMenu" owl="1">
        <li class="o_menu_item o_import_menu" role="menuitem">
            <button type="button" class="dropdown-item" t-on-click="_onImportClick">
                Import records
            </button>
        </li>
    </t>

    <t t-name="ImportView">
        <t t-set="_id" t-value="_.uniqueId('export')"/>
        <form action="" method="post" enctype="multipart/form-data" class="oe_import">
            <input type="hidden" name="csrf_token" t-att-value="csrf_token"/>
            <input type="hidden" name="import_id"/>

            <div class="d-flex h-100">
                <t t-call="ImportView.formatting_options"/>
                <t t-call="ImportView.data_matching"/>
            </div>

            <div class="o_import_partial_alert alert alert-warning d-none">
                Click 'Resume' to proceed with the import, resuming at line
                <span class="o_import_partial_count">0</span>.<br/>
                You can test or reload your file before resuming the import.
            </div>

            <div class="o_view_nocontent">
                <div class="o_nocontent_help">
                    <p class="o_view_nocontent_smiling_face">
                        Upload an Excel or CSV file to import
                    </p>
                    <p>
                        Excel files are recommended as formatting is automatic.
                    </p>
                    <div class="mt16 mb4">Need Help?</div>
                    <div t-foreach="widget.importTemplates" t-as="template">
                        <a t-att-href="template.template" aria-label="Download" title="Download">
                            <i class="fa fa-download"/> <span><t t-esc="template.label"/></span>
                        </a>
                    </div>
                    <a href="https://www.odoo.com/documentation/user/14.0/general/base_import/import_faq.html" target="new">Import FAQ</a>
                </div>
            </div>
        </form>
    </t>

    <t t-name="ImportView.buttons">
        <button type="button" class="btn btn-primary o_import_import o_import_import_full d-none">Import</button>
        <button type="button" class="btn btn-primary o_import_import o_import_import_partial d-none">Resume</button>
        <button type="button" class="btn btn-secondary o_import_validate d-none">Test</button>
        <button type="button" class="btn btn-primary oe_import_file">Upload File</button>
        <button type="button" class="btn btn-secondary o_import_cancel">Cancel</button>
    </t>

    <t t-name="ImportView.create_record_option">
        <div t-attf-class="o_import_field_icon oe_import_dropdown o_import_field_#{data.type} position-relative">
            <select class="o_import_create_option">
                <option t-if="data.type === 'boolean'" value="true">Set to: True</option>
                <option t-if="data.type === 'boolean'" value="false">Set to: False</option>

                <t t-set="is_relational" t-value="data.type === 'many2many' || data.type === 'many2one'"/>
                <option t-if="is_relational || data.type === 'selection'" value="false">Prevent import</option>
                <option t-if="!data.required &amp;&amp; (is_relational || data.type === 'selection')" value="skip">Skip unknown values</option>
                <option t-if="is_relational" value="create">Create new values</option>
                <t t-if="data.type === 'selection'">
                    <option t-foreach="values" t-as="value" t-att-value="value">Set to: <t t-esc="value"/></option>
                </t>
            </select>
        </div>
    </t>

    <t t-name="ImportView.preview">
        <thead>
            <tr class="oe_import_grid-header">
                <td class="oe_import_grid-cell"><span class="o_single_line_text" title="File Column">File Column</span></td>
                <td class="oe_import_grid-cell"><span class="o_single_line_text" title="File Column">Odoo Field</span></td>
                <td class="oe_import_grid-cell oe_import_options_header">
                    <span class="o_single_line_text" title="File Column">If a match cannot be found</span></td>
                <td class="oe_import_grid-cell"><span class="o_single_line_text" title="File Column">Comments</span></td>
            </tr>
        </thead>
        <tbody>
            <t t-set="columns" t-value="headers || preview"/>
            <tr t-if="columns" t-foreach="columns" t-as="column" class="oe_import_grid-row">
                <t t-set="idx" t-value="columns.indexOf(column)"/>
                <td class="oe_import_grid-cell oe_import_name_cell">
                    <span class="o_import_header_name o_single_line_text" t-att-title="column"><t t-esc="column"/></span>
                    <span t-if="options['headers']" class="font-italic text-muted small"><t t-esc="preview[idx]"/></span>
                </td>
                <td class="oe_import_grid-cell oe_import_match_cell">
                    <input class="oe_import_match_field oe_import_dropdown"/>
                </td>
                <td class="oe_import_grid-cell oe_import_options_cell"></td>
                <td class="oe_import_grid-cell oe_import_comment_cell"></td>
            </tr>
        </tbody>
    </t>

    <t t-name="ImportView.comment_same_mapped_field">
        <div class="oe_import_same_mapped_field alert alert-info">
            This column will be concatenated in field <b t-esc="field"/>
        </div>
    </t>

    <t t-name="ImportView.preview.error">
        <div class="oe_import_report alert alert-danger">
            <p>Import preview failed due to: <t t-esc="error"/>.</p>
            <p>For CSV files, you may need to select the correct separator.</p>
            <p t-if="preview">Here is the start of the file we could not import:</p>
        </div>
        <pre t-if="preview"><t t-esc="preview"/></pre>
    </t>
    <div t-name="ImportView.error" t-attf-class="oe_import_report alert alert-#{errors[0].type}">
        <t t-if="errors.length gt 1">
            <t t-if="field">
                <t t-call="ImportView.error.single.field.multi.error"></t>
            </t>
            <t t-else="">
                <t t-call="ImportView.error.multi.header">
                    <t t-set="error" t-value="errors[0]"/>
                    <t t-set="error_length" t-value="errors.length"/>
                </t>
                <ul>
                    <t t-foreach="errors.length" t-as="index">
                        <li t-att-class="index gt 4 ? 'oe_import_report_more':''">
                            <t t-call="ImportView.error.multi.body">
                                <t t-set="error" t-value="errors[index]"/>
                                <t t-set="index" t-value="index"/>
                            </t>
                        </li>
                        <li t-if="errors.length gt 5 and index == 4" style="display: block;">
                            <a href="#" class="oe_import_report_count">
                                <t t-esc="more(errors.length - 5)"/>
                            </a>
                        </li>
                    </t>
                </ul>
                <t t-if="errors[0].moreinfo" t-raw="info(errors[0].moreinfo)"/>
            </t>
        </t>
        <t t-else="">
            <t t-call="ImportView.error.single">
                <t t-set="error" t-value="errors[0]"/>
            </t>
        </t>
    </div>
    <t t-name="ImportView.error.multi.header">
        <span class="oe_import_report_message">
            <t t-esc="error.message"/>
            <t t-esc="at_multi_header(error_length)"/>
        </span>
    </t>
    <t t-name="ImportView.error.multi.body">
        <span class="oe_import_report_message">
            <t t-esc="at_multi(error.rows)"/>
        </span>
    </t>
    <t t-name="ImportView.error.single">
        <span class="oe_import_report_message">
            <t t-if="error.field_name">
                No matching records found for <t t-esc="error.field_type"/> <b>'<t t-esc="error.value"/>'</b> in field <b t-esc="error.field_name"/>
            </t>
            <b t-else="" t-esc="error.message"/>
        </span>
        <t t-if="error.rows"  t-esc="at(error.rows)"/>
        <t t-if="error.moreinfo" t-raw="info(error.moreinfo)"/>
    </t>

    <t t-name="ImportView.error.single.field.multi.error">
        <div class="oe_import_report_message">
            No matching records found for the following <t t-esc="errors[0].field_type"/> in field <b><t t-esc="errors[0].field_name"/></b>:
            <ul>
                <t t-foreach="errors.length" t-as="index">
                    <li t-att-class="index gt 2 ? 'oe_import_report_more':''">
                        <b t-esc="errors[index].value"/>
                        <t t-if="errors[index].rows" t-esc="at(errors[index].rows)"/>
                    </li>
                    <li t-if="errors.length gt 3 and index == 2" style="display: block;">
                        <a href="#" class="oe_import_report_count">
                            <t t-esc="more(errors.length - 3)"/>
                        </a>
                    </li>
                </t>
            </ul>
        </div>

        <t t-if="errors[0].moreinfo" t-raw="info(errors[0].moreinfo)"/>
    </t>

    <t t-name="ImportView.data_matching">
        <div class="oe_import_with_file d-none">
            <div class="oe_import_noheaders">
                <p class="alert alert-info">If the file contains
                    the column names, Odoo can try auto-detecting the
                    field corresponding to the column. This makes imports
                    simpler especially when the file has many columns.</p>
            </div>
            <div class="oe_import_error_report px-3 py-2"></div>
            <div class="table-responsive">
                <table class="table-striped oe_import_grid" />
            </div>
        </div>
    </t>

    <t t-name="ImportView.formatting_options">
        <div class="oe_import_box d-none">
            <input accept=".csv, .xls, .xlsx, .xlsm, .ods" t-attf-id="file_#{_id}"
                  name="file" class="oe_import_file" type="file" style="display:none;"/>
            <div class="oe_import_with_file">
                <div>
                    <h4 class="oe_import_option_title">Import file<i class="fa fa-caret-up"/></h4>
                    <div class="oe_import_options_toggle">
                        <input type="checkbox" class="oe_import_has_header custom-control-input"
                               id="oe_import_has_header" checked="checked"/>
                        <label class="custom-control-label" for="oe_import_has_header">Use first row as header</label>


                        <div class="oe_import_has_multiple_sheets js_import_options">
                            <label for="oe_import_sheet">Selected Sheet:</label>
                            <input class="oe_import_sheet" id="oe_import_sheet"/>
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="oe_import_option_title">Formatting<i class="fa fa-caret-up"/></h4>
                    <div class="oe_import_options_toggle">
                        <!--<div class="oe_import_options">-->
                            <!--<t t-call="base_import.OptionDateFormat"/>-->
                            <!--<t t-call="base_import.OptionDatetimeFormat"/>-->
                            <!--<t t-call="base_import.OptionSeparator"/>-->
                            <!--<t t-call="base_import.OptionThousandsSeparator"/>-->
                            <!--<t t-call="base_import.OptionDecimalSeparator"/>-->
                            <!--<t t-call="base_import.OptionQuoting"/>-->
                            <!--<t t-call="base_import.OptionEncoding"/>-->
                        <!--</div>-->
                        <div t-foreach="[widget.opts, widget.parse_opts_formats, widget.parse_opts_separators]" t-as="options" class="oe_import_options">
                            <div t-attf-class="mb-1 oe_import_#{option.type}_box #{option.name !== 'date_format' ? 'oe_import_option_csv_only' : ''}" t-foreach="options" t-as="option">
                                <!-- no @name, avoid submission when file_update called -->
                                <label t-attf-for="#{option.name}_#{_id}">
                                    <t t-esc="option.label"/></label>
                                <input
                                       t-attf-id="#{option.name}_#{_id}"
                                       t-attf-class="oe_import_#{option.name} oe_import_dropdown w-100 mb-3"
                                       t-att-value="option.value"/>
                                <!--<select t-if="option.type == 'select'"-->
                                       <!--t-attf-id="#{option.name}_#{_id}"-->
                                       <!--t-attf-class="oe_import_#{option.name} w-100 mb-3"-->
                                       <!--t-att-value="option.value"/>-->
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="oe_import_option_title">Batch Import<i class="fa fa-caret-up"/></h4>
                    <div class="oe_import_options_toggle">
                        <div class="o_import_batch_alert alert alert-info d-none">
                            The file will be imported by batches.
                        </div>
                        <div class="d-flex">
                            <div class="js_import_options oe_import_options oe_import_debug_option oe_import_batch_limit w-50 pr-1">
                                <label class="mb-1" for="oe_import_batch_limit">Batch limit</label>
                                <input class="w-100" id="oe_import_batch_limit" value="2000"/>
                            </div>
                            <div class="js_import_options oe_import_options oe_import_debug_option w-50 pl-1" title="Warning: ignores the labels line, empty lines and
                                    lines composed only of empty cells">
                                <label class="mb-1" for="oe_import_row_start">Start at line</label>
                                <input class="w-100" id="oe_import_row_start" value="1"/>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="oe_import_debug_options d-flex flex-column">
                    <h4 class="oe_import_option_title">Advanced<i class="fa fa-caret-up"/></h4>
                    <div class="oe_import_options_toggle">
                        <div title="If the model uses openchatter, history tracking will set up subscriptions and send notifications during the import, but lead to a slower import." class="oe_import_debug_option">
                            <input type="checkbox" id="oe_import_tracking" class="custom-control-input"/>
                            <label class="custom-control-label" for="oe_import_tracking">
                                Track history during import
                            </label>
                        </div>

                        <div class="oe_import_debug_option">
                            <input type="checkbox" class="oe_import_advanced_mode custom-control-input" checked="checked"
                                   id="oe_import_advanced_mode"/>
                            <label class="custom-control-label" for="oe_import_advanced_mode">Show fields of relation fields</label>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </t>
</templates>

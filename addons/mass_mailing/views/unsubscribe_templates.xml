<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="mass_mailing_unsubscribe_template">
        <t t-call="web.layout">
            <t t-set="head">
                <t t-call-assets="web.assets_common" t-js="false"/>
                <t t-call-assets="web.assets_common" t-css="false"/>
                <t t-call-assets="web.assets_backend" t-css="false"/>
                <t t-call-assets="web.assets_backend" t-js="false"/>
            </t>
            <div class="container">
                <div class="row">
                    <div class="col-md-2">
                        <img t-attf-src="data:image/png;base64,#{to_text(res_company.logo)}" class="img img-responsive" t-att-title="res_company.name"/>
                    </div>
                </div>
                <t t-raw="0"/>
            </div>
        </t>
    </template>

    <template id="unsubscribe">
        <t t-call="mass_mailing.mass_mailing_unsubscribe_template">
            <div class="row o_unsubscribe_form">
                <div class="col-md-12">
                    <h3 class="text-center">Mailing Subscriptions</h3>
                </div>
                <div class="col-md-6 col-md-offset-3">
                    <form action="/mail/mailing/unsubscribe" method="POST" id="unsubscribe_form">
                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                        <input type="hidden" name="email" t-att-value="email"/>
                        <input type="hidden" name="contact_id" t-att-value="contact.id"/>
                        <input type="hidden" name="token" t-att-value="token"/>
                        <input type="hidden" name="mailing_id" t-att-value="mailing.id"/>
                        <t t-if="contact and contact.list_ids">
                            <ul class="list-group">
                                <t t-foreach="contact.list_ids" t-as="contact_list">
                                    <li class="list-group-item">
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" name="mailing_ids" class="mail_list_checkbox" t-att-value="contact_list['id']" t-att-checked="'checked'"/> <t t-esc="contact_list.name"/>
                                            </label>
                                        </div>
                                    </li>
                                </t>
                            </ul>
                            <div>
                                <input type="submit" id="send_form" class="btn btn-block btn-primary" value="Update my subscriptions"/>
                            </div>
                        </t>
                        <t t-else="">
                            <div class="alert alert-warning text-center">
                                <i class="fa fa-info-circle"/> You are not subscribed to any of our mailing list.
                            </div>
                        </t>
                    </form>
                </div>
            </div>
        </t>
    </template>

    <template id="unsubscribe_success">
        <t t-call="mass_mailing.mass_mailing_unsubscribe_template">
            <div class="row">
                <div class="col-md-12 text-center">
                    <i class="fa fa-check-circle fa-5x text-success"></i>
                    <h3>Your mailing preference has been updated successfully!</h3>
                </div>
            </div>
        </t>
    </template>
</odoo>
